var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{a(r.next(t))}catch(e){s(e)}}function h(t){try{a(r["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,h)}a((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(o=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,s=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(r){i=[6,r],s=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,o,h,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),t=new Pudding(1),this.addChildAt(t,8),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var r=new egret.Shape;r.graphics.beginFill(0,.5),r.graphics.drawRect(0,0,e,172),r.graphics.endFill(),r.y=33,this.addChild(r);var n=this.createBitmapByName("egret_icon_png");this.addChild(n),n.x=26,n.y=33;var s=new egret.Shape;s.graphics.lineStyle(2,16777215),s.graphics.moveTo(0,0),s.graphics.lineTo(0,117),s.graphics.endFill(),s.x=172,s.y=61,this.addChild(s);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var h=new egret.TextField;this.addChild(h),h.alpha=0,h.width=e-172,h.textAlign=egret.HorizontalAlign.CENTER,h.size=24,h.textColor=16777215,h.x=172,h.y=135,this.textfield=h},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,r=t.map(function(t){return i.parse(t)}),n=this.textfield,s=-1,o=function(){s++,s>=r.length&&(s=0);var t=r[s];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,e)};o()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Pudding=function(t){function e(e){var i=t.call(this)||this;return i.STEP_ROT=3,i.PUD_WIDTH=300,i.PUD_HEI=300,i.FORK_WIDTH=60,i.FORK_HEI=240,i.DEPTH=5,i.level=1,i.forkNum=0,i.FORK_NUM=[4,6,8,10,12,14,16,18,20,22],i.SPEED=[3,4,5,6,7,8,9,9,9,9],i.gameOver=!1,i.STEP_ROT=i.SPEED[i.level-1],i.forkNum=i.FORK_NUM[i.level-1],i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){this.spr=new egret.Sprite,this.loadResource(),this.addChild(this.spr)},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.imageComp,this),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.drawInfo=function(){this.textInfo=new egret.TextField,this.addChild(this.textInfo),this.textInfo.text="当前关卡："+this.level+"\n剩余叉子数："+this.forkNum,this.textInfo.textColor=221,this.textInfo.x=100,this.textInfo.y=.75*this.stage.stageHeight},e.prototype.updateInfo=function(){this.textInfo.text="当前关卡："+this.level+"\n剩余叉子数："+this.forkNum},e.prototype.createSprPud=function(){this.spr_pud=new egret.Sprite,this.spr_pud.width=this.PUD_WIDTH+this.FORK_HEI,this.spr_pud.height=this.PUD_WIDTH+2*this.FORK_HEI,this.spr_pud.anchorOffsetX=this.spr_pud.width/2,this.spr_pud.anchorOffsetY=this.spr_pud.height/2,this.spr_pud.x=this.stage.stageWidth/2,this.spr_pud.y=.3*this.stage.stageHeight,this.spr.addChild(this.spr_pud)},e.prototype.drawPudding=function(){this.pudding_img=new egret.Bitmap,this.pudding_img.texture=RES.getRes("pudding_png"),this.pudding_img.width=this.PUD_WIDTH,this.pudding_img.height=this.PUD_HEI,this.pudding_img.anchorOffsetX=this.pudding_img.width/2,this.pudding_img.anchorOffsetY=this.pudding_img.height/2,this.pudding_img.x=this.spr_pud.width/2,this.pudding_img.y=this.spr_pud.height/2,this.spr_pud.addChild(this.pudding_img)},e.prototype.drawFork=function(){this.fork_img=new egret.Bitmap,this.fork_img.texture=RES.getRes("fork_png"),this.fork_img.width=this.FORK_WIDTH,this.fork_img.height=this.FORK_HEI,this.fork_img.anchorOffsetX=this.fork_img.width/2,this.fork_img.anchorOffsetY=this.fork_img.height/2,this.fork_img.x=this.stage.stageWidth/2,this.fork_img.y=.75*this.stage.stageHeight,this.spr.addChild(this.fork_img)},e.prototype.imageComp=function(){this.createSprPud(),this.drawPudding(),this.drawFork(),this.launchAnimations(),this.drawInfo(),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shotFork,this)},e.prototype.launchAnimations=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.loopFunc,this)},e.prototype.loopFunc=function(t){return this.spr_pud.rotation+=this.STEP_ROT,!1},e.prototype.shotFork=function(t){console.log("click"),this.tween=egret.Tween.get(this.fork_img,{onChange:this.funcChange,onChangeObj:this}),this.tween.to({x:this.fork_img.x,y:this.spr_pud.y+this.PUD_WIDTH/2+this.FORK_HEI/2-this.DEPTH},300,egret.Ease.sineIn).call(this.afterSucc,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.shotFork,this)},e.prototype.afterSucc=function(){this.addForkToPud(),this.fork_img.parent&&this.fork_img.parent.removeChild(this.fork_img),this.fork_img=null,this.drawFork(),this.gameOver||this.forkNum--,0==this.forkNum&&this.nextLevel(this.level+1),this.updateInfo(),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shotFork,this)},e.prototype.addForkToPud=function(){var t=new egret.Bitmap;t.texture=RES.getRes("fork_png"),t.anchorOffsetX=this.FORK_WIDTH/2,t.anchorOffsetY=0,t.width=this.FORK_WIDTH,t.height=this.FORK_HEI;var e=this.spr_pud.width/2,i=this.spr_pud.height/2,r=this.PUD_WIDTH/2-this.DEPTH,n=(180-this.spr_pud.rotation)/180*Math.PI,s=e+Math.sin(n)*r,o=i-Math.cos(n)*r;t.x=s,t.y=o,t.rotation=-this.spr_pud.rotation,this.spr_pud.addChild(t)},e.prototype.funcChange=function(){var t=this.fork_img.x+this.FORK_WIDTH/2,e=this.fork_img.x-this.FORK_WIDTH/2,i=parseInt((this.fork_img.y-this.fork_img.anchorOffsetY).toString());if(!this.gameOver){var r=this.spr_pud.hitTestPoint(t,i,!0),n=this.spr_pud.hitTestPoint(e,i,!0);(r||n)&&(console.log("!!!!!"),this.gameOver=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this.loopFunc,this))}},e.prototype.nextLevel=function(t){this.level++,this.STEP_ROT=this.SPEED[this.level-1],this.forkNum=this.FORK_NUM[this.level-1],console.log(this.numChildren),this.spr_pud.removeChildren(),this.spr_pud.addChild(this.pudding_img)},e}(egret.Sprite);__reflect(Pudding.prototype,"Pudding");